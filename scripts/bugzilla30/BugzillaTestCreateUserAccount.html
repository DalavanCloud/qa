<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Create user login from home page</title>
  </head>

  <body>
    <table cellpadding="1" cellspacing="1" border="1">
    <thead>
      <tr>
        <td rowspan="1" colspan="3">Create user login from home page</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>loadConfigFileAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>storeParams</td>
        <td>inst branch admin_user_login admin_user_passwd</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>open</td>
        <td>${inst}relogin.cgi</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Home</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Main Page</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_password</td>
        <td>${admin_user_passwd}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_password</td>
        <td>${admin_user_passwd}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Login']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Main Page</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Parameters</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>exact:Configuration: Required Settings</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=User Authentication</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>exact:Configuration: User Authentication</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We will restore this param at the end of the test -->
      <tr>
        <td>storeValue</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>original_regexp</td>
      </tr>
      <tr>
        <td>type</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>[^@]+@bugzilla\.jp</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>[^@]+@bugzilla\.jp</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Save Changes']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Parameters Updated</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Now try to create a new account -->
      <tr>
        <td>clickAndWait</td>
        <td>link=Log out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=New Account</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Create a new Bugzilla account</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>selenium@bugzilla.jp</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>selenium@bugzilla.jp</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Request for new user account 'selenium@bugzilla.jp' submitted</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>To confirm the creation of the user account selenium@bugzilla.jp</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Email To expect failure -->
      <tr>
        <td>clickAndWait</td>
        <td>link=New Account</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Create a new Bugzilla account</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>paul@yahoo.com</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>paul@yahoo.com</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Account Creation Disabled</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>User account creation has been disabled or restricted</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Email #2 To expect failure -->
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>paul@bugzilla.net</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>paul@bugzilla.net</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Account Creation Disabled</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>User account creation has been disabled or restricted</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Email #3 To expect failure -->
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>paul@bugzilla..jp</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>paul@bugzilla..jp</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Account Creation Disabled</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>User account creation has been disabled or restricted</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Email #4 To expect failure due to invalid syntax -->
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>paul\bugzilla@bugzilla.jp</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>paul\bugzilla@bugzilla.jp</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Invalid Email Address</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>The e-mail address you entered (paul\bugzilla@bugzilla.jp) didn't pass our syntax checking</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Email #5 To expect failure due to invalid syntax -->
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>paul@bugzilla.org@bugzilla.jp</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>paul@bugzilla.org@bugzilla.jp</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Invalid Email Address</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>The e-mail address you entered (paul@bugzilla.org@bugzilla.jp) didn't pass our syntax checking</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Email #6 To expect failure due to an existing account -->
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Send']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Account Already Exists</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td> There is already an account with the login name ${admin_user_login}</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Now clear 'createemailregexp' to disabling creation of new accounts -->
      <tr>
        <td>clickAndWait</td>
        <td>link=Home</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Main Page</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_password</td>
        <td>${admin_user_passwd}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_password</td>
        <td>${admin_user_passwd}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Login']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Main Page</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Parameters</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>exact:Configuration: Required Settings</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=User Authentication</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>exact:Configuration: User Authentication</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We restore this param to its previous value -->
      <tr>
        <td>type</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Save Changes']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Parameters Updated</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Log out and make sure there is no link available in the footer -->
      <tr>
        <td>clickAndWait</td>
        <td>link=Log out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextNotPresent</td>
        <td>New Account</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Make sure direct access to createaccount.cgi is rejected -->
      <tr>
        <td>open</td>
        <td>${inst}createaccount.cgi</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Account Creation Disabled</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>User account creation has been disabled or restricted</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Make sure the link on the home page isn't displayed too -->
      <tr>
        <td>clickAndWait</td>
        <td>link=Home</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Main Page</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextNotPresent</td>
        <td>Open a new Bugzilla account</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Restore the previous param -->
      <tr>
        <td>type</td>
        <td>Bugzilla_login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_login</td>
        <td>${admin_user_login}</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_password</td>
        <td>${admin_user_passwd}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_password</td>
        <td>${admin_user_passwd}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Login']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Main Page</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Parameters</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>exact:Configuration: Required Settings</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=User Authentication</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>exact:Configuration: User Authentication</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We restore this param to its previous value -->
      <tr>
        <td>type</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>${original_regexp}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>//input[@name="createemailregexp"]</td>
        <td>${original_regexp}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Save Changes']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Parameters Updated</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Make sure the user account we just wanted to create has not been added to the DB -->
      <tr>
        <td>clickAndWait</td>
        <td>link=Users</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Search users</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>matchstr</td>
        <td>selenium@bugzilla.jp</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>matchstr</td>
        <td>selenium@bugzilla.jp</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Search']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Select user</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertFlatTextPresent</td>
        <td>0 users found</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Log out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
    </table>
  </body>
</html>
