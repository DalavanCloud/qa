<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Test Saved Searches</title>
  </head>

  <body>
    <table cellpadding="1" cellspacing="1" border="1">
      <thead>
      <tr>
        <td rowspan="1" colspan="3">Bugzilla Test Saved Searches</td>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>loadConfigFileAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>storeParams</td>
        <td>inst branch QA_Selenium_TEST_user_login QA_Selenium_TEST_user_passwd</td>
        <td>&nbsp;</td>
      </tr>
        <tr>
          <td>open</td>
          <td>${inst}relogin.cgi</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log In</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Log in to Bugzilla</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>${QA_Selenium_TEST_user_login}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_login</td>
          <td>${QA_Selenium_TEST_user_login}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_password</td>
          <td>${QA_Selenium_TEST_user_passwd}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_password</td>
          <td>${QA_Selenium_TEST_user_passwd}</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>//input[@type='submit' and @value='Log in']</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Main Page</td>
          <td>&nbsp;</td>
        </tr>
      <tr>
        <td>open</td>
        <td>${inst}userprefs.cgi?tab=saved-searches</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>User Preferences</td>
        <td>&nbsp;</td>
      </tr>
      <!-- If the saved search exists, remove it -->
      <tr>
        <td><b>assertNoErrorOnNextAndGoto</b></td>
        <td>'SavedSearchTEST1' was found in page text.</td>
        <td>check_search_end</td>
      </tr>
      <tr>
        <td>assertTextNotPresent</td>
        <td>SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//a[@href="buglist.cgi?cmdtype=dorem&remaction=forget&namedcmd=SavedSearchTEST1"]</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Search is gone</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>OK, the SavedSearchTEST1 search is gone</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><b>label</b></td>
        <td>check_search_end</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Create a new saved search -->
      <tr>
        <td>open</td>
        <td>${inst}query.cgi?format=advanced</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Search for bugs</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>short_desc</td>
        <td>test search</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>short_desc</td>
        <td>test search</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Search']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bug List</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newqueryname</td>
        <td>SavedSearchTEST1</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newqueryname</td>
        <td>SavedSearchTEST1</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Remember search']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Message</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>OK, you have a new search named SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Make sure the link exists in the footer -->
      <tr>
        <td>clickAndWait</td>
        <td>link=SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bug List: SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Prefs</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>User Preferences</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Saved searches</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>User Preferences</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTextPresent</td>
        <td>SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Remove it from the footer -->
      <tr>
        <td>click</td>
        <td>//input[@name='linkinfooter_SavedSearchTEST1']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>//input[@name='linkinfooter_SavedSearchTEST1']</td>
        <td>off</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Submit Changes']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>User Preferences</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>The changes to your saved searches have been saved</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Search</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Search for bugs</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>short_desc</td>
        <td>bilboa</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>short_desc</td>
        <td>bilboa</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Search']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bug List</td>
        <td>&nbsp;</td>
      </tr>
      <!-- The saved search we created should not be displayed in the footer -->
      <tr>
        <td>verifyTextNotPresent</td>
        <td>SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Now update the saved search -->
      <tr>
        <td>type</td>
        <td>newqueryname</td>
        <td>SavedSearchTEST1</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newqueryname</td>
        <td>SavedSearchTEST1</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Remember search']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bugzilla Message</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>Your search named SavedSearchTEST1 has been updated</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Verify that our search criteria has really been saved -->
      <!-- Updating the saved search makes it to be redisplayed in the footer -->
      <tr>
        <td>clickAndWait</td>
        <td>link=SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bug List: SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Edit Search</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Search for bugs</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>short_desc</td>
        <td>bilboa</td>
      </tr>
      <!-- The 'Run' link in userprefs.cgi in Bugzilla 2.20 contains the full buglist.cgi URL instead
           of its shortcut below. So we run it from here directly, without using links in userprefs.cgi -->
      <tr>
        <td>clickAndWait</td>
        <td>//a[@href='buglist.cgi?cmdtype=runnamed&namedcmd=SavedSearchTEST1']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Bug List: SavedSearchTEST1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Forget Search 'SavedSearchTEST1'</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Search is gone</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>OK, the SavedSearchTEST1 search is gone</td>
        <td>&nbsp;</td>
      </tr>
      </tbody>
    </table>
  </body>
</html>
