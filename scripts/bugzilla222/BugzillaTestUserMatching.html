<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Test User Matching</title>
  </head>

  <body>
    <table cellpadding="1" cellspacing="1" border="1">
    <thead>
      <tr>
        <td rowspan="1" colspan="3">Bugzilla Test User Matching</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>loadConfigFileAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>storeParams</td>
        <td>inst branch common_email test_bug_1
            tweakparams_user_login tweakparams_user_login_truncated tweakparams_user_passwd
            unprivileged_user_login unprivileged_user_login_truncated unprivileged_user_passwd
            canconfirm_user_login</td>
        <td>&nbsp;</td>
      </tr>
    <!-- It's important to log out and then to log in with some very specific privs, for testing -->
    <tr>
      <td>open</td>
      <td>${inst}relogin.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Logged Out</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>clickAndWait</td>
      <td>link=Log In</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Log in to Bugzilla</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_login</td>
        <td>${tweakparams_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_login</td>
        <td>${tweakparams_user_login}</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_password</td>
        <td>${tweakparams_user_passwd}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_password</td>
        <td>${tweakparams_user_passwd}</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Log in']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Main Page</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Don't waste our time following links; we know they work. Directly jump to the correct page -->
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_1</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Be sure to turn this parameter off. We will test it later -->
      <tr>
        <td>click</td>
        <td>//input[@name='usemenuforusers' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We first make sure that when we say 'off', it's really off -->
      <tr>
        <td>select</td>
        <td>//select[@name="usermatchmode"]</td>
        <td>label=off</td>
      </tr>
      <!-- Don't restrict the number of matches -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>0</td>
      </tr>
      <!-- Set it to 'on' to make sure that exact matching doesn't trigger this warning -->
      <tr>
        <td>click</td>
        <td>//input[@name='confirmuniqueusermatch' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Turn 'off' group restrictions. We will turn it 'on' later -->
      <tr>
        <td>click</td>
        <td>//input[@name='usevisibilitygroups' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_1</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_1</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi?section=usermatch</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: User Matching</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Be sure to turn this parameter off. We will test it later -->
      <tr>
        <td>click</td>
        <td>//input[@name='usemenuforusers' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We first make sure that when we say 'off', it's really off -->
      <tr>
        <td>select</td>
        <td>//select[@name="usermatchmode"]</td>
        <td>label=off</td>
      </tr>
      <!-- Don't restrict the number of matches -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>0</td>
      </tr>
      <!-- Set it to 'on' to make sure that exact matching doesn't trigger this warning -->
      <tr>
        <td>click</td>
        <td>//input[@name='confirmuniqueusermatch' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Group Security</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Group Security</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Turn 'off' group restrictions. We will turn it 'on' later -->
      <tr>
        <td>click</td>
        <td>//input[@name='usevisibilitygroups' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_1</td>
      <td>&nbsp;</td>
    </tr>
    <!-- Again, don't waste our time here. Directly view the bug -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${test_bug_1}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We entered an incomplete email address, but user matching is off. It must complain -->
      <tr>
        <td>assertTitle</td>
        <td>Match Failed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>${unprivileged_user_login_truncated} did not match anything</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We entered the complete email address, which is a valid user account. Accept the submission -->
      <tr>
        <td>assertTitle</td>
        <td>Bug processed</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Don't waste our time following links; we know they work. Directly jump to the correct page -->
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_2</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now test wildcards -->
      <tr>
        <td>select</td>
        <td>//select[@name="usermatchmode"]</td>
        <td>label=wildcard</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_2</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_2</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi?section=usermatch</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: User Matching</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now test wildcards -->
      <tr>
        <td>select</td>
        <td>//select[@name="usermatchmode"]</td>
        <td>label=wildcard</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_2</td>
      <td>&nbsp;</td>
    </tr>
    <!-- Again, don't waste our time here. Directly view the bug -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${test_bug_1}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We are in mode 'wildcard', not 'search, so strings with no '*' are considered as exact matches -->
      <tr>
        <td>assertTitle</td>
        <td>Match Failed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>${unprivileged_user_login_truncated} did not match anything</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}*</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}*</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We used a wildcard, so now it should work -->
      <tr>
        <td>assertTitle</td>
        <td>Confirm Match</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextPresent</td>
        <td><${unprivileged_user_login}></td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We entered a complete and valid user account. The 'confirm match' message should not be triggered -->
      <tr>
        <td>assertTitle</td>
        <td>Bug processed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${test_bug_1}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>*${common_email}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>*${common_email}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Catch at least two accounts -->
      <tr>
        <td>assertTitle</td>
        <td>Confirm Match</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>${common_email} matched:</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Don't waste our time following links; we know they work. Directly jump to the correct page -->
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_3</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now we restrict the number of matches to exactly 1, that's pretty restrictive -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>1</td>
      </tr>
      <!-- Usual 'search' mode -->
      <tr>
        <td>select</td>
        <td>//select[@name="usermatchmode"]</td>
        <td>label=search</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_3</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_3</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi?section=usermatch</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: User Matching</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now we restrict the number of matches to exactly 1, that's pretty restrictive -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>1</td>
      </tr>
      <!-- Usual 'search' mode -->
      <tr>
        <td>select</td>
        <td>//select[@name="usermatchmode"]</td>
        <td>label=search</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_3</td>
      <td>&nbsp;</td>
    </tr>
    <!-- Again, don't waste our time here. Directly view the bug -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${test_bug_1}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Substrings are allowed, so no wildcard is required -->
      <tr>
        <td>assertTitle</td>
        <td>Confirm Match</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td><${unprivileged_user_login}></td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>*${common_email}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>*${common_email}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We should have many matches, but we are very restrictive about this (max = 1) -->
      <tr>
        <td>assertTitle</td>
        <td>Match Failed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>matches multiple users. Please go back and try again with a more specific name/address</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Exact match, no warning triggered -->
      <tr>
        <td>assertTitle</td>
        <td>Bug processed</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Don't waste our time following links; we know they work. Directly jump to the correct page -->
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_4</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now we restrict the number of matches to 2 -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>2</td>
      </tr>
      <!-- Turn 'on' group restrictions -->
      <tr>
        <td>click</td>
        <td>//input[@name='usevisibilitygroups' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_4</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_4</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi?section=usermatch</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: User Matching</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now we restrict the number of matches to 2 -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>2</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Group Security</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Group Security</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Turn 'on' group restrictions -->
      <tr>
        <td>click</td>
        <td>//input[@name='usevisibilitygroups' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_4</td>
      <td>&nbsp;</td>
    </tr>
    <!-- Again, don't waste our time here. Directly view the bug -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${test_bug_1}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${unprivileged_user_login_truncated}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We are not in the same group as the user we CC'ed, and so we cannot see him -->
      <tr>
        <td>assertTitle</td>
        <td>Match Failed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>${unprivileged_user_login_truncated} did not match anything</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${common_email}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${common_email}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- There is at least two users we can see: ourselves and the admin -->
      <tr>
        <td>assertTitle</td>
        <td>Confirm Match</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>${common_email} matched more than the maximum of 2 users</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>newcc</td>
        <td>${tweakparams_user_login_truncated}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>newcc</td>
        <td>${tweakparams_user_login_truncated}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We can see ourselves -->
      <tr>
        <td>verifyTitle</td>
        <td>Confirm Match</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextPresent</td>
        <td><${tweakparams_user_login}></td>
        <td>&nbsp;</td>
      </tr>
      <!-- Don't waste our time following links; we know they work. Directly jump to the correct page -->
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_5</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now test user menus. It must NOT display user we are not allowed to see -->
      <tr>
        <td>click</td>
        <td>//input[@name='usemenuforusers' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_5</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_5</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi?section=usermatch</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: User Matching</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Now test user menus. It must NOT display user we are not allowed to see -->
      <tr>
        <td>click</td>
        <td>//input[@name='usemenuforusers' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_5</td>
      <td>&nbsp;</td>
    </tr>
    <!-- Again, don't waste our time here. Directly view the bug -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${test_bug_1}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Make sure users we are not allowed to see are not displayed -->
      <tr>
        <td>assertSelectNotPresentOptions</td>
        <td>newcc</td>
        <td>${canconfirm_user_login}, ${unprivileged_user_login}</td>
      </tr>
      <!-- Don't waste our time following links; we know they work. Directly jump to the correct page -->
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_6</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Remove user menus -->
      <tr>
        <td>click</td>
        <td>//input[@name='usemenuforusers' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Reset the max number of matches -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>0</td>
      </tr>
      <!-- Turn 'off' confirmations when there is only one match -->
      <tr>
        <td>click</td>
        <td>//input[@name='confirmuniqueusermatch' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Turn 'off' group restrictions -->
      <tr>
        <td>click</td>
        <td>//input[@name='usevisibilitygroups' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_6</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_6</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>open</td>
      <td>${inst}editparams.cgi?section=usermatch</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: User Matching</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Remove user menus -->
      <tr>
        <td>click</td>
        <td>//input[@name='usemenuforusers' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Reset the max number of matches -->
      <tr>
        <td>type</td>
        <td>//input[@name="maxusermatches"]</td>
        <td>0</td>
      </tr>
      <!-- Turn 'off' confirmations when there is only one match -->
      <tr>
        <td>click</td>
        <td>//input[@name='confirmuniqueusermatch' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Group Security</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Group Security</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Turn 'off' group restrictions -->
      <tr>
        <td>click</td>
        <td>//input[@name='usevisibilitygroups' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Save Changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_6</td>
      <td>&nbsp;</td>
    </tr>
    </tbody>
    </table>
  </body>
</html>
