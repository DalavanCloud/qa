<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Test Shared Searches</title>
  </head>

  <body>
    <table cellpadding="1" cellspacing="1" border="1">
      <thead>
        <tr>
          <td rowspan="1" colspan="3">Bugzilla Test Shared Searches</td>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>loadConfigFileAndWait</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>storeParams</td>
          <td>inst branch admin_user_login admin_user_passwd canconfirm_user_login canconfirm_user_passwd QA_Selenium_TEST_user_login QA_Selenium_TEST_user_passwd</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>open</td>
          <td>${inst}relogin.cgi</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log in again.</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Log in to Bugzilla</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>${admin_user_login}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_login</td>
          <td>${admin_user_login}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_password</td>
          <td>${admin_user_passwd}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_password</td>
          <td>${admin_user_passwd}</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>log_in</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Main Page</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Parameters</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>exact:Configuration: Required Settings</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Group Security</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>exact:Configuration: Group Security</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>select</td>
          <td>//select[@name='querysharegroup']</td>
          <td>label=canconfirm</td>
        </tr>
        <tr>
          <td>verifySelected</td>
          <td>//select[@name='querysharegroup']</td>
          <td>label=canconfirm</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>//input[@type='submit' and @value='Save Changes']</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Parameters Updated</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>quicksearch</td>
          <td>:TestProduct Selenium</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>quicksearch</td>
          <td>exact::TestProduct Selenium</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>find_top</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bug List</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>save_newqueryname</td>
          <td>Shared Selenium buglist</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>save_newqueryname</td>
          <td>Shared Selenium buglist</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>remember</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Message</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyFlatTextPresent</td>
          <td>OK, you have a new search named Shared Selenium buglist</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- Retrieve the saved search ID -->
        <tr>
          <td>storeAttribute</td>
          <td>//input[@type='checkbox' and @alt='Shared Selenium buglist']@name</td>
          <td>ssname</td>
        </tr>
        <tr>
          <td>parseString</td>
          <td>${ssname}</td>
          <td>(?:link_in_footer_(\d+))</td>
        </tr>
        <tr>
          <td>store</td>
          <td>javascript{storedVars["_match"][2]}</td>
          <td>saved_search1_id</td>
        </tr>
        <!-- Our own saved searches are displayed in the footer by default -->
        <tr>
          <td>verifyValue</td>
          <td>link_in_footer_${saved_search1_id}</td>
          <td>on</td>
        </tr>
        <tr>
          <td>select</td>
          <td>share_${saved_search1_id}</td>
          <td>label=canconfirm</td>
        </tr>
        <tr>
          <td>verifySelected</td>
          <td>share_${saved_search1_id}</td>
          <td>label=canconfirm</td>
        </tr>
        <!-- As an admin, we can force our saved search to be displayed by default
             in other user's footer. -->
        <tr>
          <td>click</td>
          <td>force_${saved_search1_id}</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>force_${saved_search1_id}</td>
          <td>on</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>update</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log In</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Log in to Bugzilla</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>${canconfirm_user_login}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_login</td>
          <td>${canconfirm_user_login}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_password</td>
          <td>${canconfirm_user_passwd}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_password</td>
          <td>${canconfirm_user_passwd}</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>log_in</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Main Page</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyFlatTextPresent</td>
          <td>Shared Selenium buglist</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Shared Selenium buglist</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bug List: Shared Selenium buglist</td>
          <td>&nbsp;</td>
        </tr>
        <!-- You cannot delete other users' saved searches -->
        <tr>
          <td>verifyTextNotPresent</td>
          <td>Forget Search 'Shared Selenium buglist'</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- The admin has shared a saved search with us. We should see his name. -->
        <tr>
          <td>verifyTextPresent</td>
          <td>${admin_user_login}</td>
          <td>&nbsp;</td>
        </tr>
        <!-- Admins' saved searches are displayed in the footer by default if he decided so. -->
        <tr>
          <td>verifyValue</td>
          <td>link_in_footer_${saved_search1_id}</td>
          <td>on</td>
        </tr>
        <tr>
          <td>click</td>
          <td>link_in_footer_${saved_search1_id}</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>link_in_footer_${saved_search1_id}</td>
          <td>off</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>update</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Permissions</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- The saved search should not be displayed in the footer anymore. -->
        <tr>
          <td>verifyTextNotPresent</td>
          <td>Shared Selenium buglist</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>quicksearch</td>
          <td>:TestProduct sw:helpwated</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>quicksearch</td>
          <td>exact::TestProduct sw:helpwated</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>find_top</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bug List</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>save_newqueryname</td>
          <td>helpwanted</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>save_newqueryname</td>
          <td>helpwanted</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>remember</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Message</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyFlatTextPresent</td>
          <td>OK, you have a new search named helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- Retrieve the saved search ID -->
        <tr>
          <td>storeAttribute</td>
          <td>//input[@type='checkbox' and @alt='helpwanted']@name</td>
          <td>ssname</td>
        </tr>
        <tr>
          <td>parseString</td>
          <td>${ssname}</td>
          <td>(?:link_in_footer_(\d+))</td>
        </tr>
        <tr>
          <td>store</td>
          <td>javascript{storedVars["_match"][2]}</td>
          <td>saved_search2_id</td>
        </tr>
        <!-- Our own saved searches are displayed in the footer by default. -->
        <tr>
          <td>verifyValue</td>
          <td>link_in_footer_${saved_search2_id}</td>
          <td>on</td>
        </tr>
        <tr>
          <td>select</td>
          <td>share_${saved_search2_id}</td>
          <td>label=canconfirm</td>
        </tr>
        <tr>
          <td>verifySelected</td>
          <td>share_${saved_search2_id}</td>
          <td>label=canconfirm</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>update</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log in again.</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Log in to Bugzilla</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>${admin_user_login}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_login</td>
          <td>${admin_user_login}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_password</td>
          <td>${admin_user_passwd}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_password</td>
          <td>${admin_user_passwd}</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>log_in</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Main Page</td>
          <td>&nbsp;</td>
        </tr>
        <!-- The other user is not a blesser for the canconfirm group, so
             his shared saved search must not be displayed by default... -->
        <tr>
          <td>verifyTextNotPresent</td>
          <td>helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- ... but it must be available anyway. -->
        <tr>
          <td>verifyTextPresent</td>
          <td>helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyTextPresent</td>
          <td>${canconfirm_user_login}</td>
          <td>&nbsp;</td>
        </tr>
        <!-- As we said, it's not displayed by default. -->
        <tr>
          <td>verifyValue</td>
          <td>link_in_footer_${saved_search2_id}</td>
          <td>off</td>
        </tr>
        <tr>
          <td>click</td>
          <td>link_in_footer_${saved_search2_id}</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>link_in_footer_${saved_search2_id}</td>
          <td>on</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>update</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- Now the link is displayed in the footer. -->
        <tr>
          <td>clickAndWait</td>
          <td>link=helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bug List: helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- It's time to do some cleanup -->
        <tr>
          <td>clickAndWait</td>
          <td>//a[@href='buglist.cgi?cmdtype=dorem&remaction=forget&namedcmd=Shared%20Selenium%20buglist']</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Search is gone</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyFlatTextPresent</td>
          <td>OK, the Shared Selenium buglist search is gone</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log in again.</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Log in to Bugzilla</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>${QA_Selenium_TEST_user_login}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_login</td>
          <td>${QA_Selenium_TEST_user_login}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_password</td>
          <td>${QA_Selenium_TEST_user_passwd}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_password</td>
          <td>${QA_Selenium_TEST_user_passwd}</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>log_in</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Main Page</td>
          <td>&nbsp;</td>
        </tr>
        <!-- This user cannot see the 'helpwanted' saved search, because
             he doesn't belong to the canconfirm group. -->
        <tr>
          <td>verifyTextNotPresent</td>
          <td>helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- The saved search must not be available. -->
        <tr>
          <td>verifyTextNotPresent</td>
          <td>helpwanted</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log In</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Log in to Bugzilla</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_login</td>
          <td>${canconfirm_user_login}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_login</td>
          <td>${canconfirm_user_login}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>Bugzilla_password</td>
          <td>${canconfirm_user_passwd}</td>
        </tr>
        <tr>
          <td>verifyValue</td>
          <td>Bugzilla_password</td>
          <td>${canconfirm_user_passwd}</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>log_in</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Bugzilla Main Page</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Saved Searches</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>User Preferences</td>
          <td>&nbsp;</td>
        </tr>
        <!-- This saved search has been deleted and so is no longer available. -->
        <tr>
          <td>verifyTextNotPresent</td>
          <td>Shared Selenium buglist</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>//a[@href='buglist.cgi?cmdtype=dorem&remaction=forget&namedcmd=helpwanted']</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Search is gone</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>verifyFlatTextPresent</td>
          <td>OK, the helpwanted search is gone</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>clickAndWait</td>
          <td>link=Log out</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td>assertTitle</td>
          <td>Logged Out</td>
          <td>&nbsp;</td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
