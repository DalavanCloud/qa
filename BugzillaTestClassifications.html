<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Test Classifications</title>
  </head>

  <body>
    <table cellpadding="1" cellspacing="1" border="1">
    <thead>
      <tr>
        <td rowspan="1" colspan="3">Bugzilla Test Classifications</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>loadConfigFileAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>storeParams</td>
        <td>inst branch</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>open</td>
        <td>${inst}editparams.cgi</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_1</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='useclassification' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_1</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_1</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Required Settings</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Bug Fields</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Bug Fields</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='useclassification' and @value='1']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Save Changes']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_1</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Classifications</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Select classification</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Add</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Add new classification</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>type</td>
        <td>classification</td>
        <td>cone</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>classification</td>
        <td>cone</td>
      </tr>
      <tr>
        <td>type</td>
        <td>description</td>
        <td>Classification number 1</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>description</td>
        <td>Classification number 1</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Add']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Adding new classification</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=edit</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Select classification</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//a[@href='editclassifications.cgi?action=reclassify&classification=cone']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Reclassify products</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>select</td>
        <td>prodlist</td>
        <td>value=TestProduct</td>
      </tr>
      <tr>
        <td>verifySelected</td>
        <td>prodlist</td>
        <td>value=TestProduct</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='     Add &gt;&gt;  ']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifySelectOptions</td>
        <td>myprodlist</td>
        <td>TestProduct</td>
      </tr>
      <!-- Let's create a new bug in this classification -->
      <tr>
        <td>clickAndWait</td>
        <td>link=New</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Select Classification</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=cone</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Enter Bug: TestProduct</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>type</td>
        <td>short_desc</td>
        <td>Bug in classification cone</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>short_desc</td>
        <td>Bug in classification cone</td>
      </tr>
      <tr>
        <td>type</td>
        <td>comment</td>
        <td>Created by Selenium with classifications turned on</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>comment</td>
        <td>Created by Selenium with classifications turned on</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='    Commit    ']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug \d+ Submitted</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>[cone]</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>storeValue</td>
        <td>//input[@name='id' and @type='hidden']</td>
        <td>bug1_id</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Classifications</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Select classification</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=cone</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Edit classification</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>classification</td>
        <td>Unclassified</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>classification</td>
        <td>Unclassified</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Update']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Classification Already Exists</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>classification</td>
        <td>ctwo</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>classification</td>
        <td>ctwo</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Update']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Update classification</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Make sure this classification name change has been reflected in bugs too -->
      <!-- It's only a name change, so the classification ID in the products table should not have changed -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${bug1_id}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${bug1_id} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>[ctwo]</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Classifications</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Select classification</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//a[@href='editclassifications.cgi?action=del&classification=ctwo']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Error</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>Sorry, there are products for this classification</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>goBackAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//a[@href='editclassifications.cgi?action=reclassify&classification=ctwo']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Reclassify products</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>select</td>
        <td>myprodlist</td>
        <td>TestProduct</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='&lt;&lt; Remove']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=edit</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Select classification</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//a[@href='editclassifications.cgi?action=del&classification=ctwo']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Delete classification</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>Do you really want to delete this classification?</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Yes, delete']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Classification deleted</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Restore previous state, i.e. without classifications -->
      <tr>
        <td>open</td>
        <td>${inst}editparams.cgi</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td><b>gotoIf</b></td>
      <td>storedVars["branch"] == 222</td>
      <td>bz_222_editparams_2</td>
    </tr>
    <!-- Code for 2.20 -->
    <tr>
      <td>assertTitle</td>
      <td>Edit parameters</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='useclassification' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>clickAndWait</td>
      <td>//input[@type='submit' and @value='Submit changes']</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td>assertTitle</td>
      <td>Saving new parameters</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>gotoLabel</b></td>
      <td>bz_222_editparams_end_2</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_2</td>
      <td>&nbsp;</td>
    </tr>
      <!-- Code for 2.22 -->
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Required Settings</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Bug Fields</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Bugzilla Configuration: Bug Fields</td>
      <td>&nbsp;</td>
    </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='useclassification' and @value='0']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Save Changes']</td>
        <td>&nbsp;</td>
      </tr>
    <tr>
      <td>assertTitle</td>
      <td>Parameters Updated</td>
      <td>&nbsp;</td>
    </tr>
    <tr>
      <td><b>label</b></td>
      <td>bz_222_editparams_end_2</td>
      <td>&nbsp;</td>
    </tr>
    <!-- The classification should not appear on the bug page anymore -->
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${bug1_id}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${bug1_id} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextNotPresent</td>
        <td>[ctwo]</td>
        <td>&nbsp;</td>
      </tr>
      <!-- editclassifications.cgi should not be accessible anymore -->
      <tr>
        <td>open</td>
        <td>${inst}editclassifications.cgi</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTitle</td>
        <td>Classification Not Enabled</td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
    </table>
  </body>
</html>
