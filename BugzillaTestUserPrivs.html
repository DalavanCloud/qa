<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
    <title>Test User Privs</title>
  </head>

  <body>
  <table cellpadding="1" cellspacing="1" border="1">
    <thead>
      <tr>
        <td rowspan="1" colspan="3">Bugzilla Test User Privs</td>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>loadConfigFileAndWait</td>
        <td>&nbsp;</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>storeParams</td>
        <td>inst branch unprivileged_user_login unprivileged_user_passwd test_bug_1</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Log out the current user -->
      <tr>
        <td>open</td>
        <td>${inst}relogin.cgi</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextPresent</td>
        <td>Your login has been forgotten</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><b>gotoIf</b></td>
        <td>storedVars["branch"] == 222</td>
        <td>footer_222</td>
      </tr>
      <tr>
        <td>type</td>
        <td>id</td>
        <td>${test_bug_1}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>id</td>
        <td>${test_bug_1}</td>
      </tr>
      <tr>
        <td><b>gotoLabel</b></td>
        <td>footer_222_end</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><b>label</b></td>
        <td>footer_222</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>quicksearch</td>
        <td>${test_bug_1}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>quicksearch</td>
        <td>${test_bug_1}</td>
      </tr>
      <tr>
        <td><b>label</b></td>
        <td>footer_222_end</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Find']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug ${test_bug_1} - .*</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='knob' and @value='reassign']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>assigned_to</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>assigned_to</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Log in to Bugzilla</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTextPresent</td>
        <td>I need a legitimate login and password to continue.</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We will log in using a user account with no privs -->
      <tr>
        <td>type</td>
        <td>Bugzilla_login</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_login</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_password</td>
        <td>${unprivileged_user_passwd}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_password</td>
        <td>${unprivileged_user_passwd}</td>
      </tr>
      <!-- We don't want to remember this login -->
      <tr>
        <td><b>assertNoErrorOnNextAndGoto</b></td>
        <td>Actual value 'on' did not match 'off'</td>
        <td>jump_checkbox_1</td>
      </tr>
      <tr>
        <td>assertValue</td>
        <td>//input[@name="Bugzilla_remember" and @value="on"]</td>
        <td>off</td>
      </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='Bugzilla_remember' and @value='on']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><b>label</b></td>
        <td>jump_checkbox_1</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Log in']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Not allowed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>You tried to change the Assignee field</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>to ${unprivileged_user_login} , but only the assignee of the bug, or a sufficiently empowered user may change that field.</td>
        <td>&nbsp;</td>
      </tr>
      <!-- Now submit a bug using this unprivileged_user account -->
      <tr>
        <td>clickAndWait</td>
        <td>link=New</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We don't want to fail if classifications are in use -->
      <tr>
        <td><b>assertNoErrorOnNextAndGoto</b></td>
        <td>Actual value 'Select Classification' did not match 'Enter Bug'</td>
        <td>jump_classification_end</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Enter Bug</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Unclassified</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><b>label</b></td>
        <td>jump_classification_end</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=TestProduct</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Enter Bug: TestProduct</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyNotEditable</td>
        <td>assigned_to</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>short_desc</td>
        <td>test for 2902, created by selenium</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>short_desc</td>
        <td>test for 2902, created by selenium</td>
      </tr>
      <tr>
        <td>type</td>
        <td>comment</td>
        <td>enter new bug with empty CC list</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>comment</td>
        <td>enter new bug with empty CC list</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='    Commit    ']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>regexp:Bug \d+ Submitted</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextPresent</td>
        <td>has been added to the database</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We need a way to know which bug we have just created -->
      <tr>
        <td>storeValue</td>
        <td>id</td>
        <td>created_bug_id</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Log out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>open</td>
        <td>${inst}show_bug.cgi?id=${created_bug_id}</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='knob' and @value='reassign']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>type</td>
        <td>assigned_to</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>assigned_to</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Commit']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Log in to Bugzilla</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTextPresent</td>
        <td>I need a legitimate login and password to continue.</td>
        <td>&nbsp;</td>
      </tr>
      <!-- We log in using the same user account (the one with no privs) -->
      <tr>
        <td>type</td>
        <td>Bugzilla_login</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_login</td>
        <td>${unprivileged_user_login}</td>
      </tr>
      <tr>
        <td>type</td>
        <td>Bugzilla_password</td>
        <td>${unprivileged_user_passwd}</td>
      </tr>
      <tr>
        <td>verifyValue</td>
        <td>Bugzilla_password</td>
        <td>${unprivileged_user_passwd}</td>
      </tr>
      <!-- We don't want to remember this login -->
      <tr>
        <td><b>assertNoErrorOnNextAndGoto</b></td>
        <td>Actual value 'on' did not match 'off'</td>
        <td>jump_checkbox_2</td>
      </tr>
      <tr>
        <td>assertValue</td>
        <td>//input[@name="Bugzilla_remember" and @value="on"]</td>
        <td>off</td>
      </tr>
      <tr>
        <td>click</td>
        <td>//input[@name='Bugzilla_remember' and @value='on']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><b>label</b></td>
        <td>jump_checkbox_2</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>//input[@type='submit' and @value='Log in']</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>assertTitle</td>
        <td>Not allowed</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>You tried to change the Assignee field</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyFlatTextPresent</td>
        <td>to ${unprivileged_user_login} , but only the assignee of the bug, or a sufficiently empowered user may change that field.</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>clickAndWait</td>
        <td>link=Log out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTitle</td>
        <td>Logged Out</td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td>verifyTextPresent</td>
        <td>Your login has been forgotten</td>
        <td>&nbsp;</td>
      </tr>
    </tbody>
  </table>
  </body>
</html>
